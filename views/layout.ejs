<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | ShadowCore</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="icon" type="image/svg+xml" href="/static/assets/logo.svg">
    
    <% if (theme === 'light') { %>
        <style>
            body { background: #f8fafc; color: #0f172a; }
        </style>
    <% } %>
    
    <%# Plugin-specific CSS injection %>
    <% if (plugins && Array.isArray(plugins)) { %>
        <% plugins.forEach(plugin => { %>
            <% if (plugin.css) { %>
                <style><%= plugin.css %></style>
            <% } %>
        <% }) %>
    <% } %>
</head>
<body class="<%= theme || 'dark' %>-theme">
    
    <% if (!special) { %>
        <nav class="navbar">
            <div class="container nav-content">
                <a href="/" class="logo">
                    <span class="logo-icon">üåô</span>
                    <span>ShadowCore</span>
                </a>
                
                <button class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <div class="nav-links" id="navLinks">
                    <a href="/" class="nav-link <%= currentPath === '/' ? 'active' : '' %>">
                        Home
                    </a>
                    <a href="/features" class="nav-link <%= currentPath === '/features' ? 'active' : '' %>">
                        Features
                    </a>
                    <a href="/plugins" class="nav-link <%= currentPath === '/plugins' ? 'active' : '' %>">
                        Plugins
                    </a>
                    
                    <% if (user) { %>
                        <a href="/dashboard" class="nav-link <%= currentPath === '/dashboard' ? 'active' : '' %>">
                            Dashboard
                        </a>
                        
                        <% if (user.role === 'admin') { %>
                            <a href="/admin" class="nav-link <%= currentPath.startsWith('/admin') ? 'active' : '' %>">
                                Admin
                            </a>
                        <% } %>
                        
                        <div class="dropdown">
                            <button class="btn btn-sm btn-secondary">
                                üë§ <%= user.username %>
                            </button>
                            <div class="dropdown-menu">
                                <a href="/profile" class="dropdown-item">Profile</a>
                                <a href="/settings" class="dropdown-item">Settings</a>
                                <div class="dropdown-divider"></div>
                                <a href="/logout" class="dropdown-item text-danger">Logout</a>
                            </div>
                        </div>
                    <% } else { %>
                        <a href="/login" class="nav-link <%= currentPath === '/login' ? 'active' : '' %>">
                            Login
                        </a>
                        <a href="/signup" class="btn btn-sm btn-primary">
                            Sign Up
                        </a>
                    <% } %>
                    
                    <label class="theme-switch">
                        <input type="checkbox" id="themeToggle" <%= theme === 'light' ? 'checked' : '' %>>
                        <span class="theme-slider"></span>
                    </label>
                </div>
            </div>
        </nav>
    <% } %>
    
    <main>
        <%- body %>
    </main>
    
    <% if (!special) { %>
        <footer style="
            text-align: center;
            padding: 3rem 0;
            margin-top: 4rem;
            border-top: 1px solid var(--glass-border);
            color: var(--gray);
        ">
            <div class="container">
                <p>ShadowCore v3.0 | Advanced Modular Platform</p>
                <p style="margin-top: 1rem; font-size: 0.9rem;">
                    ¬© 2024 Abdullah | Built with ‚ù§Ô∏è
                </p>
                <div style="margin-top: 1rem; display: flex; gap: 1rem; justify-content: center;">
                    <a href="/admin/login" style="color: var(--gray); text-decoration: none;">Admin</a>
                    <a href="/love/anushay" style="color: var(--primary); text-decoration: none;">‚ù§Ô∏è</a>
                    <a href="/health" style="color: var(--gray); text-decoration: none;">Status</a>
                </div>
            </div>
        </footer>
    <% } %>
    
    <%# Notification container %>
    <div id="notificationContainer" class="notification-container"></div>
    
    <%# Plugin-specific JS injection %>
    <% if (plugins && Array.isArray(plugins)) { %>
        <% plugins.forEach(plugin => { %>
            <% if (plugin.js) { %>
                <script><%= plugin.js %></script>
            <% } %>
        <% }) %>
    <% } %>
    
    <%# Main JavaScript %>
    <script src="/static/js/main.js"></script>
    
    <% if (user && user.role === 'admin') { %>
        <script src="/static/js/admin.js"></script>
    <% } %>
    
    <script>
        // Theme toggle
        document.getElementById('themeToggle')?.addEventListener('change', function() {
            document.body.classList.toggle('light-theme');
            document.body.classList.toggle('dark-theme');
            
            // Save preference
            localStorage.setItem('theme', this.checked ? 'light' : 'dark');
            
            // Send to server if logged in
            if (typeof user !== 'undefined' && user.id) {
                fetch('/api/settings/theme', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ theme: this.checked ? 'light' : 'dark' })
                });
            }
        });
        
        // Mobile menu toggle
        document.getElementById('hamburger')?.addEventListener('click', function() {
            this.classList.toggle('active');
            document.getElementById('navLinks').classList.toggle('active');
        });
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('navLinks');
            
            if (hamburger && navLinks && 
                !hamburger.contains(e.target) && 
                !navLinks.contains(e.target)) {
                hamburger.classList.remove('active');
                navLinks.classList.remove('active');
            }
        });
        
        // Auto-hide notifications
        setTimeout(() => {
            const notifications = document.querySelectorAll('.notification');
            notifications.forEach(notification => {
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            });
        }, 1000);
    </script>
</body>
</html>
